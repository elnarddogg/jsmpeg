! function( Promise ) {

    if (typeof exports === 'object') {
        module.exports = Promise;
    }
    else {
        window.WeePromise = Promise;
        window.Promise = window.Promise || Promise;
    }

}(function(a, b) {
    function c(a) {
        var c = this;
        g(c, k, 0), g(c, l, []), g(c, p, []), g(c, q, []), g(c, r, []), b(function() {
            a(d(c, q), d(c, r))
        }, 0)
    }
    function d(a, b) {
        return function(c) {
            a[k] || a[t](b, c)[t](p, c)[u]()
        }
    }
    function e(a, b, c, d, e) {
        return function() {
            var g = f(a, 1),
                i = f(a, - 1);
            if (h(g) === d) {
                var j = g.map(function(a) {
                    return a[l][0]
                });
                b(e ? j[0] : j)
            } else h(i) > 0 && c(i[0][l][0])
        }
    }
    function f(a, b) {
        return a.filter(function(a) {
            return a[k] === b
        })
    }
    function g(b, c, d) {
        a.defineProperty(b, c, {
            value: d,
            writable: !0
        })
    }
    function h(a) {
        return a.length
    }
    function i(a, b) {
        a.forEach(b)
    }
    var j = "prototype",
        k = "state",
        l = "args",
        m = "always",
        n = "then",
        o = "catch",
        p = "_" + m,
        q = "_" + n,
        r = "_" + o,
        s = "_addHandler",
        t = "_execHandler",
        u = "_clear",
        v = {};
    return v[r] = -1, v[q] = 1, c[j][s] = function(a, b) {
        var c = this;
        return b && c[a].push(b), c
    }, c[j][t] = function(a, b) {
        b = [b];
        var c = this,
            d = c[a],
            e = h(d),
            f = 0;
        try {
            for (; e > f && h(d) > 0;)(v[a] ? d.shift() : d[f]).apply(null, b), f++
        } catch (g) {
            c[t](r, g, !0)
        }
        return c[l] = b, c[k] = v[a] || c[k], c
    }, c[j][m] = function(a) {
        return this[s](p, a)
    }, c[j][n] = function(a, b) {
        return this[s](q, a)[o](b)
    }, c[j][o] = function(a) {
        return this[s](r, a)
    }, c[j][u] = function() {
        var a = this;
        a[q] = [], a[r] = [], a[p] = []
    }, c.all = function(a) {
        return new c(function(b, c) {
            i(a, function(d) {
                d[m](e(a, b, c, h(a)))
            })
        })
    }, c.race = function(a) {
        return new c(function(b, c) {
            i(a, function(d) {
                d[m](e(a, b, c, 1, !0))
            })
        })
    }, c
}(Object, setTimeout));